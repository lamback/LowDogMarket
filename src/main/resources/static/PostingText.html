<!DOCTYPE html>
<html>
<head land="en">
    <meta charset="UTF-8">
    <title>微淘发布框</title>
    <style type="text/css">
        *{padding:0;margin: 0;font-size: 12px;}
        .weibodiv{
            margin: 20px auto;
            width: 600px;
        }
        .weibotext{
            float: left;
            top: 30px;
            margin: 5px auto;
            display: block;
        }
        textarea{
            height: 170px;
            width: 590px;
            border: 1px solid rgb(64,224,208);
            font-size: 20px;
            overflow: auto;
        }
        #weibotextnum{
            float: right;
            font-size: 14px;
            /*         opacity: 0; */
        }
        #weibotextnumber{
            font-size: 20px;
            font-family:Bell MT;

        }
        .post{
            width: 80px;
            height: 30px;
            border: 1px solid;
            text-align: center;
            font-size: 20px;
            text-decoration: none;
            border-radius: 5px;
            color: #ffffff;
            background: #8BC528;
            font-weight: bold;
            float: right;
            margin: 3px;
            letter-spacing: 5px;
            line-height: 30px;
            cursor: pointer;
        }
    </style>
    <link rel="stylesheet" href="css/managerFirstPageCss.css">
    <link rel="stylesheet" href="css/goodsdetail.css">
    <script type="text/javascript" src="js/jquery-1.8.3.min.js"></script>
</head>
<body>
<div class="top">
    <div class="ncuLogin"><img src="image/南昌大学login.jpg" alt="" ></div>
    <div class="address">我的店铺</div>
    <div class="manager"><img src="image/头像.png" alt="头像" height="18px" width="18px">
        管理员<br>
        <a href="">返回</a>
    </div>
</div>
<div class="nav">
    <div class="content">
        <ul>
            <li style=" background-color: rgba(250,250,250,0.5);"><a href="shopManage.html"><img src="image/首页-选中.png" alt="" height="40px" width="40px;"></a></li>
            <li><a href="addGoods.html">上传商品</a></li>
            <li><a href="undoGoods.html">撤销商品</a></li>
            <li><a href="xiaoshoue.html">销售详情</a></li>
            <li><a href="PostingText.html">发帖子</a></li>
        </ul>
    </div>
</div>
<div align="center" style="font-size: 25px">
    微淘发布~
</div>
<div class="weibodiv">
    <div class="weibotext">
        <textarea>
        </textarea>
    </div>
    <span class="weibobottomlink"></span>
    <button class="post" onclick="PostTZ()">发布</button>
    <input type="file" id="importFile"/>
    <input type="button"  value="确认图片" onclick="upload()"/>
    <img src="" height="200" title="preview-img" class="showPic">
    <script>
        var nowPic = 0;
        var Data ={
            photo1:"",
            photo2:"",
            photo3:"",
            photo4:"",
            photo5:"",
            photo6:"",
            comments:""
        };
        var fileInput = document.querySelector('input[type=file]'),
            previewImg = document.getElementsByClassName("showPic")[0];
        fileInput.addEventListener('change', function () {
            var file = this.files[0];
            var reader = new FileReader();
            // 监听reader对象的的onload事件，当图片加载完成时，把base64编码賦值给预览图片
            reader.addEventListener("load", function () {
                previewImg.src = reader.result;
            }, false);
            // 调用reader.readAsDataURL()方法，把图片转成base64
            reader.readAsDataURL(file);
        }, false);
        function upload() {
            var filename = document.getElementById("importFile").value;
            // 这时的filename不是 importFile 框中的值
            var s = getPath(document.getElementById("importFile"));
            if (s!="") nowPic+=1;
            switch (nowPic) {
                case 1: Data.photo1 = s;break;
                case 2: Data.photo2 = s;break;
                case 3: Data.photo3 = s;break;
                case 4: Data.photo4 = s;break;
                case 5: Data.photo5 = s;break;
                case 6: Data.photo6 = s;break;
            }
            document.getElementById("importFile").value ="";
            alert("当前已经上传了"+nowPic+"张图片！");
        }
        function getPath(obj) {
            if(obj)
            {

                if (window.navigator.userAgent.indexOf("MSIE")>=1)
                {
                    obj.select();

                    return document.selection.createRange().text;
                }

                else if(window.navigator.userAgent.indexOf("Firefox")>=1)
                {
                    if(obj.files)
                    {

                        return obj.files.item(0).getAsDataURL();
                    }
                    return obj.value;
                }
                return obj.value;
            }
        }
        function PostTZ() {
            Data.comments = document.getElementsByTagName('textarea')[0].value;
            $.ajax( {
                url:"/addPostings",
                type: "POST",
                data:Data,
                contentType:'application/json;charset=utf-8',
                dataType:"json",
                success: function(){
                    alert("发布帖子成功！")
                },
                error:function(){
                    alert("上传失败");
                }
            })
        }
    </script>
</div>
</body>
</html>